<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma de Servicios Locales - √Årbol B</title>
    <style>
        /* Variables CSS - Tema Oscuro */
        :root {
            --primary-color: #6366f1;
            --secondary-color: #f59e0b;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
            --accent-color: #22d3ee;
            --node-color: #475569;
            --node-border: #64748b;
            --highlight-color: #8b5cf6;
        }

        /* Reset y base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-color) 0%, #1a202c 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--card-bg), #2d3748);
            padding: 30px;
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 24px;
            background: var(--card-bg);
            padding: 8px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .tab-button {
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            flex: 1;
            min-width: fit-content;
        }

        .tab-button:hover {
            background: var(--bg-color);
            color: var(--text-primary);
        }

        .tab-button.active {
            background: linear-gradient(135deg, var(--primary-color), var(--highlight-color));
            color: white;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Sections */
        .search-section,
        .add-section,
        .all-providers-section,
        .comparison-section,
        .tree-section {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }

        .search-section h2,
        .add-section h2,
        .all-providers-section h2,
        .comparison-section h2,
        .tree-section h2 {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: 600;
        }

        /* Forms */
        .search-form,
        .provider-form {
            display: grid;
            gap: 20px;
            margin-bottom: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-group input,
        .form-group select {
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--bg-color);
            color: var(--text-primary);
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        /* Buttons */
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        button:not(.tab-button) {
            background: linear-gradient(135deg, var(--primary-color), var(--highlight-color));
            color: white;
        }

        button:not(.tab-button):hover {
            background: linear-gradient(135deg, #5855eb, #7c3aed);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        /* Provider Cards */
        .provider-card {
            background: linear-gradient(135deg, var(--card-bg), #334155);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }

        .provider-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2);
            transform: translateY(-2px);
        }

        .provider-card h3 {
            color: var(--accent-color);
            margin-bottom: 8px;
            font-size: 1.2rem;
        }

        .provider-card p {
            color: var(--text-secondary);
            margin: 4px 0;
        }

        .provider-rating {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .stars {
            color: var(--secondary-color);
            font-size: 1.1rem;
        }

        /* Tree Visualization Styles */
        .tree-container {
            margin-top: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            border-radius: 16px;
            border: 2px solid var(--border-color);
            overflow-x: auto;
            min-height: 400px;
        }

        .tree-svg {
            width: 100%;
            min-height: 400px;
            background: radial-gradient(circle at center, rgba(99, 102, 241, 0.05), transparent);
        }

        .tree-node {
            fill: var(--node-color);
            stroke: var(--node-border);
            stroke-width: 2;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tree-node:hover {
            fill: var(--highlight-color);
            stroke: var(--accent-color);
            stroke-width: 3;
        }

        .tree-node.highlight {
            fill: var(--accent-color);
            stroke: var(--secondary-color);
            stroke-width: 3;
            filter: drop-shadow(0 0 8px rgba(34, 211, 238, 0.6));
        }

        .tree-text {
            fill: var(--text-primary);
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            font-size: 11px;
            font-weight: 600;
            text-anchor: middle;
            dominant-baseline: central;
        }

        .tree-connection {
            stroke: var(--accent-color);
            stroke-width: 2;
            opacity: 0.7;
        }

        /* Statistics Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-color), var(--highlight-color));
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--shadow-lg);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Tree Controls */
        .tree-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-color);
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .control-group label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .control-group input,
        .control-group select {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        /* Messages and Loading */
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        .message.success {
            background: var(--success-color);
        }

        .message.error {
            background: var(--error-color);
        }

        .message.warning {
            background: var(--warning-color);
        }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-bg);
            padding: 30px;
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            text-align: center;
            z-index: 1000;
            border: 1px solid var(--border-color);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        /* Demo section */
        .demo-section {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(34, 211, 238, 0.1));
            border: 2px dashed var(--primary-color);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-bottom: 16px;
        }

        .demo-button {
            background: linear-gradient(135deg, var(--secondary-color), #f59e0b);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 12px;
            transition: all 0.3s ease;
        }

        .demo-button:hover {
            background: linear-gradient(135deg, #d97706, #f59e0b);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        /* Node Info Panel */
        .node-info-panel {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            max-width: 300px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            display: none;
        }

        .node-info-panel h4 {
            color: var(--accent-color);
            margin-bottom: 12px;
        }

        .node-detail {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .node-detail:last-child {
            border-bottom: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .tabs {
                flex-direction: column;
            }

            .tab-button {
                flex: none;
            }

            .tree-controls {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üîß Plataforma de Servicios Locales</h1>
            <p>Sistema de b√∫squeda eficiente usando √Årboles B</p>
        </header>

        <main class="main-content">
            <!-- Pesta√±as -->
            <div class="tabs">
                <button class="tab-button active" onclick="showTab('buscar')">üîç Buscar Proveedores</button>
                <button class="tab-button" onclick="showTab('agregar')">‚ûï Agregar Proveedor</button>
                <button class="tab-button" onclick="showTab('todos')">üìã Todos los Proveedores</button>
                <button class="tab-button" onclick="showTab('comparar')">‚ö° Comparar Rendimiento</button>
                <button class="tab-button" onclick="showTab('visualizacion')">üå≥ √Årbol Visualizaci√≥n</button>
            </div>

            <!-- Pesta√±a Buscar -->
            <div id="buscar" class="tab-content active">
                <div class="search-section">
                    <h2>Buscar Proveedores</h2>

                    <div class="search-form">
                        <div class="form-group">
                            <label>Buscar por Tipo de Servicio:</label>
                            <select id="servicioSelect">
                                <option value="">Seleccione un servicio</option>
                            </select>
                            <button onclick="buscarPorServicio()">Buscar</button>
                        </div>

                        <div class="form-group">
                            <label>Buscar por ID:</label>
                            <input type="number" id="idInput" placeholder="Ingrese ID del proveedor">
                            <button onclick="buscarPorId()">Buscar</button>
                        </div>
                    </div>

                    <div id="resultadosBusqueda" class="results-section"></div>
                </div>
            </div>

            <!-- Pesta√±a Agregar -->
            <div id="agregar" class="tab-content">
                <div class="add-section">
                    <h2>Agregar Nuevo Proveedor</h2>

                    <!-- Bot√≥n para cargar datos de ejemplo -->
                    <div class="demo-section">
                        <p><strong>Para demostraci√≥n:</strong> Puede cargar datos de ejemplo para probar el sistema</p>
                        <button type="button" onclick="cargarDatosEjemplo()" class="demo-button">
                            üìã Cargar 12 Proveedores de Ejemplo
                        </button>
                    </div>

                    <hr style="margin: 24px 0; border: 1px solid var(--border-color);">

                    <form id="proveedorForm" class="provider-form">
                        <div class="form-group">
                            <label for="nuevoId">ID:</label>
                            <input type="number" id="nuevoId" required>
                        </div>

                        <div class="form-group">
                            <label for="nuevoNombre">Nombre:</label>
                            <input type="text" id="nuevoNombre" required>
                        </div>

                        <div class="form-group">
                            <label for="nuevoServicio">Tipo de Servicio:</label>
                            <input type="text" id="nuevoServicio" required placeholder="ej: electricista, programador">
                        </div>

                        <div class="form-group">
                            <label for="nuevaCalificacion">Calificaci√≥n (1-5):</label>
                            <input type="number" id="nuevaCalificacion" min="1" max="5" step="0.1" required>
                        </div>

                        <button type="submit">Agregar Proveedor</button>
                    </form>
                </div>
            </div>

            <!-- Pesta√±a Todos -->
            <div id="todos" class="tab-content">
                <div class="all-providers-section">
                    <h2>Todos los Proveedores</h2>

                    <div class="sort-controls">
                        <label>Ordenar por:</label>
                        <select id="ordenSelect" onchange="cargarTodosProveedores()">
                            <option value="nombre">Nombre</option>
                            <option value="calificacion">Calificaci√≥n</option>
                        </select>
                        <button onclick="cargarTodosProveedores()">Actualizar</button>
                    </div>

                    <div id="todosProveedores" class="providers-grid"></div>
                </div>
            </div>

            <!-- Pesta√±a Comparar -->
            <div id="comparar" class="tab-content">
                <div class="comparison-section">
                    <h2>Comparaci√≥n de Rendimiento</h2>
                    <p>Compare la eficiencia entre b√∫squeda con √Årbol B vs. b√∫squeda lineal</p>

                    <div class="form-group">
                        <label>Servicio a comparar:</label>
                        <select id="servicioComparar">
                            <option value="">Seleccione un servicio</option>
                        </select>
                        <button onclick="compararBusqueda()">Comparar</button>
                    </div>

                    <div id="resultadosComparacion" class="comparison-results"></div>
                </div>
            </div>

            <!-- Pesta√±a Visualizaci√≥n del √Årbol -->
            <div id="visualizacion" class="tab-content">
                <div class="tree-section">
                    <h2>üå≥ √Årbol Visualizaci√≥n</h2>

                    <!-- Controles del √°rbol -->
                    <div class="tree-controls">
                        <div class="control-group">
                            <label>Zoom:</label>
                            <input type="range" id="zoomSlider" min="0.5" max="2" value="1" step="0.1" onchange="updateTreeZoom()">
                            <span id="zoomValue">100%</span>
                        </div>
                        <div class="control-group">
                            <button onclick="centerTree()">üéØ Centrar</button>
                            <button onclick="cargarVisualizacionArbol()">üîÑ Actualizar</button>
                        </div>
                        <div class="control-group">
                            <label>Animaci√≥n:</label>
                            <input type="checkbox" id="animationToggle" checked onchange="toggleAnimation()">
                        </div>
                    </div>

                    <!-- Estad√≠sticas -->
                    <div id="estadisticasInfo" class="stats-info">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <span class="stat-number" id="statTotalProveedores">0</span>
                                <span class="stat-label">Proveedores</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-number" id="statTotalNodos">0</span>
                                <span class="stat-label">Nodos</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-number" id="statAltura">0</span>
                                <span class="stat-label">Altura</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-number" id="statGrado">3</span>
                                <span class="stat-label">Grado</span>
                            </div>
                        </div>
                    </div>

                    <!-- Container del √°rbol -->
                    <div class="tree-container">
                        <svg id="treeSvg" class="tree-svg" viewBox="0 0 1200 600">
                            <defs>
                                <filter id="glow">
                                    <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                                    <feMerge>
                                        <feMergeNode in="coloredBlur"/>
                                        <feMergeNode in="SourceGraphic"/>
                                    </feMerge>
                                </filter>
                                <linearGradient id="nodeGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#475569"/>
                                    <stop offset="100%" style="stop-color:#64748b"/>
                                </linearGradient>
                            </defs>
                            <text x="600" y="300" text-anchor="middle" fill="#94a3b8" font-size="18">
                                El √°rbol aparecer√° aqu√≠ cuando agregues proveedores
                            </text>
                        </svg>
                    </div>
                </div>
            </div>
        </main>

        <!-- Panel de informaci√≥n del nodo -->
        <div id="nodeInfoPanel" class="node-info-panel">
            <h4>Informaci√≥n del Nodo</h4>
            <div id="nodeInfoContent"></div>
        </div>

        <!-- Loading y mensajes -->
        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p>Cargando...</p>
        </div>

        <div id="mensaje" class="message hidden"></div>
    </div>

    <script>
        // Variables globales
        let proveedoresData = [];
        let serviciosUnicos = [];
        let treeData = null;
        let animationEnabled = true;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            cargarServiciosUnicos();
            cargarTodosProveedores();
            configurarFormulario();
            showTab('buscar');
        });

        // Gesti√≥n de pesta√±as
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            switch(tabName) {
                case 'todos':
                    cargarTodosProveedores();
                    break;
                case 'visualizacion':
                    cargarVisualizacionArbol();
                    break;
            }
        }

        // Cargar servicios √∫nicos para los selectores
        async function cargarServiciosUnicos() {
            try {
                showLoading();
                // Simular datos para demostraci√≥n
                serviciosUnicos = ['electricista', 'plomero', 'carpintero', 'programador', 'dise√±ador', 'alba√±il'];

                const servicioSelect = document.getElementById('servicioSelect');
                const servicioComparar = document.getElementById('servicioComparar');

                servicioSelect.innerHTML = '<option value="">Seleccione un servicio</option>';
                servicioComparar.innerHTML = '<option value="">Seleccione un servicio</option>';

                serviciosUnicos.forEach(servicio => {
                    const option1 = new Option(servicio.charAt(0).toUpperCase() + servicio.slice(1), servicio);
                    const option2 = new Option(servicio.charAt(0).toUpperCase() + servicio.slice(1), servicio);
                    servicioSelect.add(option1);
                    servicioComparar.add(option2);
                });

            } catch (error) {
                console.error('Error cargando servicios:', error);
                showMessage('Error cargando servicios', 'error');
            } finally {
                hideLoading();
            }
        }

        // Buscar proveedores por servicio
        async function buscarPorServicio() {
            const servicio = document.getElementById('servicioSelect').value;

            if (!servicio) {
                showMessage('Por favor seleccione un tipo de servicio', 'warning');
                return;
            }

            try {
                showLoading();
                // Simular b√∫squeda
                const resultados = proveedoresData.filter(p => p.servicio.toLowerCase() === servicio.toLowerCase());

                mostrarResultadosBusqueda(resultados, {
                    tiempo: Math.random() * 10 + 1,
                    total: resultados.length,
                    tipo: 'servicio',
                    termino: servicio
                });

            } catch (error) {
                console.error('Error en b√∫squeda por servicio:', error);
                showMessage('Error en la b√∫squeda', 'error');
            } finally {
                hideLoading();
            }
        }

        // Buscar proveedor por ID
        async function buscarPorId() {
            const id = document.getElementById('idInput').value;

            if (!id) {
                showMessage('Por favor ingrese un ID', 'warning');
                return;
            }

            try {
                showLoading();
                const resultado = proveedoresData.find(p => p.id === parseInt(id));

                if (resultado) {
                    mostrarResultadosBusqueda([resultado], {
                        tiempo: Math.random() * 5 + 0.5,
                        total: 1,
                        tipo: 'id',
                        termino: id
                    });
                } else {
                    mostrarResultadosBusqueda([], {
                        tiempo: Math.random() * 5 + 0.5,
                        total: 0,
                        tipo: 'id',
                        termino: id
                    });
                }

            } catch (error) {
                console.error('Error en b√∫squeda por ID:', error);
                showMessage('Error en la b√∫squeda', 'error');
            } finally {
                hideLoading();
            }
        }

        // Mostrar resultados de b√∫squeda
        function mostrarResultadosBusqueda(resultados, metadata) {
            const container = document.getElementById('resultadosBusqueda');

            let html = `
                <div class="search-metadata">
                    <h3>Resultados de b√∫squeda por ${metadata.tipo}: "${metadata.termino}"</h3>
                    <p>Encontrados: <strong>${metadata.total}</strong> resultados en <strong>${metadata.tiempo.toFixed(2)} ms</strong></p>
                </div>
            `;

            if (resultados.length === 0) {
                html += '<div class="no-results"><p>No se encontraron proveedores.</p></div>';
            } else {
                html += '<div class="providers-grid">';
                resultados.forEach(proveedor => {
                    html += crearTarjetaProveedor(proveedor);
                });
                html += '</div>';
            }

            container.innerHTML = html;
        }

        // Crear tarjeta de proveedor
        function crearTarjetaProveedor(proveedor) {
            const estrellas = generarEstrellas(proveedor.calificacion);

            return `
                <div class="provider-card">
                    <h3>${proveedor.nombre}</h3>
                    <p><strong>ID:</strong> ${proveedor.id}</p>
                    <p><strong>Servicio:</strong> ${proveedor.servicio}</p>
                    <div class="provider-rating">
                        <span class="stars">${estrellas}</span>
                        <span><strong>${proveedor.calificacion}</strong>/5</span>
                    </div>
                </div>
            `;
        }

        // Generar estrellas visuales
        function generarEstrellas(calificacion) {
            const estrellaLlena = '‚≠ê';
            const estrellaVacia = '‚òÜ';
            let estrellas = '';

            for (let i = 1; i <= 5; i++) {
                estrellas += i <= Math.round(calificacion) ? estrellaLlena : estrellaVacia;
            }

            return estrellas;
        }

        // Cargar datos de ejemplo
        async function cargarDatosEjemplo() {
            try {
                showLoading();

                const proveedoresEjemplo = [
                    {id: 1, nombre: "Juan P√©rez", servicio: "electricista", calificacion: 4.5},
                    {id: 2, nombre: "Mar√≠a Gonz√°lez", servicio: "plomero", calificacion: 4.8},
                    {id: 3, nombre: "Carlos L√≥pez", servicio: "carpintero", calificacion: 4.2},
                    {id: 4, nombre: "Ana Rodr√≠guez", servicio: "programador", calificacion: 4.9},
                    {id: 5, nombre: "Pedro Mart√≠nez", servicio: "dise√±ador", calificacion: 4.3},
                    {id: 6, nombre: "Luisa Garc√≠a", servicio: "electricista", calificacion: 4.6},
                    {id: 7, nombre: "Roberto Silva", servicio: "alba√±il", calificacion: 4.1},
                    {id: 8, nombre: "Carmen Torres", servicio: "programador", calificacion: 4.7},
                    {id: 9, nombre: "Diego Morales", servicio: "plomero", calificacion: 4.4},
                    {id: 10, nombre: "Isabel Jim√©nez", servicio: "dise√±ador", calificacion: 4.8},
                    {id: 11, nombre: "Fernando Castro", servicio: "carpintero", calificacion: 4.0},
                    {id: 12, nombre: "Sof√≠a Herrera", servicio: "electricista", calificacion: 4.5}
                ];

                let agregados = 0;
                proveedoresEjemplo.forEach(proveedor => {
                    if (!proveedoresData.find(p => p.id === proveedor.id)) {
                        proveedoresData.push(proveedor);
                        agregados++;
                    }
                });

                showMessage(`Se agregaron ${agregados} proveedores de ejemplo`, 'success');
                cargarServiciosUnicos();
                cargarTodosProveedores();
                cargarVisualizacionArbol();

            } catch (error) {
                console.error('Error cargando datos de ejemplo:', error);
                showMessage('Error cargando datos de ejemplo', 'error');
            } finally {
                hideLoading();
            }
        }

        // Configurar formulario
        function configurarFormulario() {
            const form = document.getElementById('proveedorForm');
            form.addEventListener('submit', async function(e) {
                e.preventDefault();

                const formData = {
                    id: parseInt(document.getElementById('nuevoId').value),
                    nombre: document.getElementById('nuevoNombre').value.trim(),
                    servicio: document.getElementById('nuevoServicio').value.trim().toLowerCase(),
                    calificacion: parseFloat(document.getElementById('nuevaCalificacion').value)
                };

                // Validaciones b√°sicas
                if (!formData.nombre || !formData.servicio) {
                    showMessage('Por favor complete todos los campos', 'warning');
                    return;
                }

                if (formData.calificacion < 1 || formData.calificacion > 5) {
                    showMessage('La calificaci√≥n debe estar entre 1 y 5', 'warning');
                    return;
                }

                if (proveedoresData.find(p => p.id === formData.id)) {
                    showMessage('El ID ya existe', 'error');
                    return;
                }

                try {
                    showLoading();

                    proveedoresData.push(formData);
                    proveedoresData.sort((a, b) => a.id - b.id);

                    showMessage('Proveedor agregado exitosamente', 'success');
                    form.reset();
                    cargarServiciosUnicos();
                    cargarTodosProveedores();
                    cargarVisualizacionArbol();

                } catch (error) {
                    console.error('Error agregando proveedor:', error);
                    showMessage('Error al agregar proveedor', 'error');
                } finally {
                    hideLoading();
                }
            });
        }

        // Cargar todos los proveedores
        async function cargarTodosProveedores() {
            try {
                const orden = document.getElementById('ordenSelect')?.value || 'nombre';
                let proveedoresOrdenados = [...proveedoresData];

                if (orden === 'nombre') {
                    proveedoresOrdenados.sort((a, b) => a.nombre.localeCompare(b.nombre));
                } else if (orden === 'calificacion') {
                    proveedoresOrdenados.sort((a, b) => b.calificacion - a.calificacion);
                }

                const container = document.getElementById('todosProveedores');

                if (proveedoresOrdenados.length === 0) {
                    container.innerHTML = '<p>No hay proveedores registrados.</p>';
                    return;
                }

                let html = '';
                proveedoresOrdenados.forEach(proveedor => {
                    html += crearTarjetaProveedor(proveedor);
                });

                container.innerHTML = html;

            } catch (error) {
                console.error('Error cargando proveedores:', error);
                showMessage('Error cargando proveedores', 'error');
            }
        }

        // Comparar rendimiento de b√∫squeda
        async function compararBusqueda() {
            const servicio = document.getElementById('servicioComparar').value;

            if (!servicio) {
                showMessage('Por favor seleccione un servicio para comparar', 'warning');
                return;
            }

            try {
                showLoading();

                // Simular tiempos de b√∫squeda
                const tiempoArbolB = Math.random() * 2 + 0.5;
                const tiempoLineal = Math.random() * 8 + 2;
                const resultados = proveedoresData.filter(p => p.servicio.toLowerCase() === servicio.toLowerCase());

                const data = {
                    arbol_b: {
                        resultados: resultados,
                        tiempo: tiempoArbolB.toFixed(2),
                        total: resultados.length
                    },
                    busqueda_lineal: {
                        resultados: resultados,
                        tiempo: tiempoLineal.toFixed(2),
                        total: resultados.length
                    },
                    mejora_rendimiento: (tiempoLineal / tiempoArbolB).toFixed(2)
                };

                mostrarResultadosComparacion(data, servicio);

            } catch (error) {
                console.error('Error en comparaci√≥n:', error);
                showMessage('Error en la comparaci√≥n', 'error');
            } finally {
                hideLoading();
            }
        }

        // Mostrar resultados de comparaci√≥n
        function mostrarResultadosComparacion(data, servicio) {
            const container = document.getElementById('resultadosComparacion');

            const mejora = parseFloat(data.mejora_rendimiento);
            const mejoraTexto = mejora > 1 ?
                `El √°rbol B es ${mejora}x m√°s r√°pido` :
                'Ambos m√©todos tienen rendimiento similar';

            container.innerHTML = `
                <div class="comparison-header">
                    <h3>Comparaci√≥n de b√∫squeda para: "${servicio}"</h3>
                    <div class="performance-improvement">
                        üöÄ ${mejoraTexto}
                    </div>
                </div>

                <div class="comparison-card">
                    <div class="method-result">
                        <h4>üå≥ √Årbol B</h4>
                        <div class="metric">
                            <span>Tiempo de b√∫squeda:</span>
                            <span class="metric-value">${data.arbol_b.tiempo} ms</span>
                        </div>
                        <div class="metric">
                            <span>Resultados encontrados:</span>
                            <span class="metric-value">${data.arbol_b.total}</span>
                        </div>
                    </div>

                    <div class="method-result linear">
                        <h4>üìã B√∫squeda Lineal</h4>
                        <div class="metric">
                            <span>Tiempo de b√∫squeda:</span>
                            <span class="metric-value">${data.busqueda_lineal.tiempo} ms</span>
                        </div>
                        <div class="metric">
                            <span>Resultados encontrados:</span>
                            <span class="metric-value">${data.busqueda_lineal.total}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Cargar visualizaci√≥n del √°rbol
        async function cargarVisualizacionArbol() {
            try {
                showLoading();

                // Generar estructura del √°rbol B simulada
                treeData = generateBTreeStructure(proveedoresData);

                // Actualizar estad√≠sticas
                updateStats();

                // Dibujar √°rbol
                drawTree(treeData);

            } catch (error) {
                console.error('Error cargando visualizaci√≥n:', error);
                showMessage('Error cargando visualizaci√≥n del √°rbol', 'error');
            } finally {
                hideLoading();
            }
        }

        // Generar estructura del √°rbol B
        function generateBTreeStructure(data) {
            if (data.length === 0) {
                return null;
            }

            // Simular la estructura de un √°rbol B
            const sortedData = [...data].sort((a, b) => a.id - b.id);
            const degree = 3;

            return buildBTree(sortedData, degree);
        }

        // Construir √°rbol B recursivamente
        function buildBTree(sortedData, degree) {
            if (sortedData.length === 0) return null;

            if (sortedData.length <= 2 * degree - 1) {
                return {
                    keys: sortedData.map(d => d.id),
                    data: sortedData,
                    children: [],
                    isLeaf: true
                };
            }

            const mid = Math.floor(sortedData.length / 2);
            const leftData = sortedData.slice(0, mid);
            const rightData = sortedData.slice(mid + 1);

            const node = {
                keys: [sortedData[mid].id],
                data: [sortedData[mid]],
                children: [],
                isLeaf: false
            };

            const leftChild = buildBTree(leftData, degree);
            const rightChild = buildBTree(rightData, degree);

            if (leftChild) node.children.push(leftChild);
            if (rightChild) node.children.push(rightChild);

            return node;
        }

        // Actualizar estad√≠sticas
        function updateStats() {
            const totalProveedores = proveedoresData.length;
            const totalNodos = treeData ? countNodes(treeData) : 0;
            const altura = treeData ? getTreeHeight(treeData) : 0;
            const grado = 3;

            document.getElementById('statTotalProveedores').textContent = totalProveedores;
            document.getElementById('statTotalNodos').textContent = totalNodos;
            document.getElementById('statAltura').textContent = altura;
            document.getElementById('statGrado').textContent = grado;
        }

        // Contar nodos del √°rbol
        function countNodes(node) {
            if (!node) return 0;
            let count = 1;
            node.children.forEach(child => {
                count += countNodes(child);
            });
            return count;
        }

        // Obtener altura del √°rbol
        function getTreeHeight(node) {
            if (!node || node.isLeaf) return 1;
            let maxHeight = 0;
            node.children.forEach(child => {
                maxHeight = Math.max(maxHeight, getTreeHeight(child));
            });
            return 1 + maxHeight;
        }

        // Dibujar √°rbol
        function drawTree(tree) {
            const svg = document.getElementById('treeSvg');

            // Limpiar SVG
            while (svg.children.length > 1) {
                svg.removeChild(svg.lastChild);
            }

            if (!tree) {
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', '600');
                text.setAttribute('y', '300');
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', '#94a3b8');
                text.setAttribute('font-size', '18');
                text.textContent = 'El √°rbol aparecer√° aqu√≠ cuando agregues proveedores';
                svg.appendChild(text);
                return;
            }

            // Calcular posiciones de los nodos
            const positions = calculateNodePositions(tree, 600, 80, 0);

            // Dibujar conexiones primero
            drawConnections(svg, positions);

            // Dibujar nodos
            drawNodes(svg, positions);
        }

        // Calcular posiciones de los nodos
        function calculateNodePositions(node, x, y, level) {
            const positions = [];
            const nodeWidth = 80;
            const levelHeight = 120;

            if (!node) return positions;

            // Posici√≥n del nodo actual
            const nodePos = {
                node: node,
                x: x,
                y: y,
                level: level
            };
            positions.push(nodePos);

            // Calcular posiciones de los hijos
            if (node.children && node.children.length > 0) {
                const childWidth = 200;
                const startX = x - (node.children.length - 1) * childWidth / 2;

                node.children.forEach((child, index) => {
                    const childX = startX + index * childWidth;
                    const childY = y + levelHeight;
                    const childPositions = calculateNodePositions(child, childX, childY, level + 1);
                    positions.push(...childPositions);
                });
            }

            return positions;
        }

        // Dibujar conexiones
        function drawConnections(svg, positions) {
            positions.forEach(pos => {
                if (pos.node.children && pos.node.children.length > 0) {
                    pos.node.children.forEach((child, index) => {
                        const childPos = positions.find(p => p.node === child);
                        if (childPos) {
                            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                            line.setAttribute('x1', pos.x);
                            line.setAttribute('y1', pos.y + 25);
                            line.setAttribute('x2', childPos.x);
                            line.setAttribute('y2', childPos.y - 25);
                            line.setAttribute('class', 'tree-connection');

                            if (animationEnabled) {
                                line.style.strokeDasharray = '5,5';
                                line.style.animation = 'dash 1s linear infinite';
                            }

                            svg.appendChild(line);
                        }
                    });
                }
            });
        }

        // Dibujar nodos
        function drawNodes(svg, positions) {
            positions.forEach((pos, index) => {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                g.setAttribute('class', 'tree-node-group');

                // Rect√°ngulo del nodo
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                const nodeWidth = Math.max(80, pos.node.keys.length * 25 + 20);
                const nodeHeight = 50;

                rect.setAttribute('x', pos.x - nodeWidth/2);
                rect.setAttribute('y', pos.y - nodeHeight/2);
                rect.setAttribute('width', nodeWidth);
                rect.setAttribute('height', nodeHeight);
                rect.setAttribute('class', 'tree-node');
                rect.setAttribute('rx', '8');

                // Animaci√≥n de aparici√≥n
                if (animationEnabled) {
                    rect.style.animation = `nodeAppear 0.5s ease-out ${index * 0.1}s both`;
                }

                // Evento de hover
                rect.addEventListener('mouseenter', () => showNodeInfo(pos.node, pos.x, pos.y));
                rect.addEventListener('mouseleave', hideNodeInfo);

                g.appendChild(rect);

                // Texto con las claves
                const keysText = pos.node.keys.join(', ');
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', pos.x);
                text.setAttribute('y', pos.y);
                text.setAttribute('class', 'tree-text');
                text.textContent = keysText;
                g.appendChild(text);

                // Indicador de tipo de nodo
                const indicator = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                indicator.setAttribute('cx', pos.x + nodeWidth/2 - 8);
                indicator.setAttribute('cy', pos.y - nodeHeight/2 + 8);
                indicator.setAttribute('r', '4');
                indicator.setAttribute('fill', pos.node.isLeaf ? '#10b981' : '#6366f1');
                g.appendChild(indicator);

                svg.appendChild(g);
            });
        }

        // Mostrar informaci√≥n del nodo
        function showNodeInfo(node, x, y) {
            const panel = document.getElementById('nodeInfoPanel');
            const content = document.getElementById('nodeInfoContent');

            let html = `
                <div class="node-detail">
                    <span>Tipo:</span>
                    <span>${node.isLeaf ? 'Hoja' : 'Interno'}</span>
                </div>
                <div class="node-detail">
                    <span>Claves:</span>
                    <span>${node.keys.length}</span>
                </div>
                <div class="node-detail">
                    <span>Hijos:</span>
                    <span>${node.children ? node.children.length : 0}</span>
                </div>
            `;

            if (node.data && node.data.length > 0) {
                html += '<h5 style="margin: 12px 0 8px 0; color: var(--accent-color);">Datos:</h5>';
                node.data.forEach(item => {
                    html += `
                        <div class="node-detail">
                            <span>ID ${item.id}:</span>
                            <span>${item.nombre}</span>
                        </div>
                    `;
                });
            }

            content.innerHTML = html;
            panel.style.display = 'block';
        }

        // Ocultar informaci√≥n del nodo
        function hideNodeInfo() {
            document.getElementById('nodeInfoPanel').style.display = 'none';
        }

        // Controles del √°rbol
        function updateTreeZoom() {
            const slider = document.getElementById('zoomSlider');
            const zoomValue = document.getElementById('zoomValue');
            const svg = document.getElementById('treeSvg');

            const scale = parseFloat(slider.value);
            zoomValue.textContent = Math.round(scale * 100) + '%';
            svg.style.transform = `scale(${scale})`;
        }

        function centerTree() {
            const container = document.querySelector('.tree-container');
            container.scrollLeft = (container.scrollWidth - container.clientWidth) / 2;
            container.scrollTop = (container.scrollHeight - container.clientHeight) / 2;
        }

        function toggleAnimation() {
            const checkbox = document.getElementById('animationToggle');
            animationEnabled = checkbox.checked;

            // Actualizar estilos CSS para animaciones
            const style = document.createElement('style');
            style.textContent = animationEnabled ? `
                @keyframes nodeAppear {
                    from { opacity: 0; transform: scale(0.3); }
                    to { opacity: 1; transform: scale(1); }
                }
                @keyframes dash {
                    to { stroke-dashoffset: -10; }
                }
            ` : '';
            document.head.appendChild(style);
        }

        // Utilidades para mensajes y loading
        function showMessage(message, type = 'success') {
            const messageDiv = document.getElementById('mensaje');
            messageDiv.textContent = message;
            messageDiv.className = `message ${type}`;
            messageDiv.classList.remove('hidden');

            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 4000);
        }

        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        // Manejo de errores globales
        window.addEventListener('error', function(e) {
            console.error('Error global:', e.error);
            hideLoading();
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('Promesa rechazada:', e.reason);
            hideLoading();
        });

        // Inicializar animaciones CSS
        toggleAnimation();
    </script>
</body>
</html>