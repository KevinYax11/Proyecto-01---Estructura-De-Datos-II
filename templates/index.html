<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ServiceConnect - Plataforma de Servicios Locales</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Variables CSS - Tema Oscuro Profesional */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --accent-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --success-gradient: linear-gradient(135deg, #00d4aa 0%, #01a085 100%);
            --warning-gradient: linear-gradient(135deg, #feca57 0%, #ff9ff3 100%);
            --error-gradient: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);

            /* Colores base - tema negro */
            --bg-primary: #000000;
            --bg-secondary: #111111;
            --bg-tertiary: #1a1a1a;
            --card-bg: linear-gradient(145deg, #1a1a1a, #222222);
            --card-bg-hover: linear-gradient(145deg, #222222, #2a2a2a);

            /* Texto */
            --text-primary: #ffffff;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --text-accent: #4facfe;

            /* Bordes */
            --border-primary: #333333;
            --border-secondary: #444444;
            --border-accent: #667eea;

            /* Sombras */
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.5);
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.6);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.7);
            --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.8);
            --shadow-xl: 0 12px 35px rgba(0, 0, 0, 0.9);
            --shadow-glow: 0 0 20px rgba(102, 126, 234, 0.4);
            --shadow-glow-cyan: 0 0 20px rgba(79, 172, 254, 0.3);

            /* Árbol B específico */
            --node-bg: linear-gradient(145deg, #1a1a1a, #2d2d2d);
            --node-border: #444444;
            --node-hover: linear-gradient(145deg, #2d2d2d, #3a3a3a);
            --connection-color: #667eea;
            --highlight-color: #4facfe;
            --insertion-color: #00d4aa;
            --split-color: #ff6b6b;

            /* Espaciado */
            --border-radius-xs: 4px;
            --border-radius-sm: 8px;
            --border-radius-md: 12px;
            --border-radius-lg: 16px;
            --border-radius-xl: 20px;

            /* Transiciones */
            --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Reset y base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
        }

        /* Patrón de fondo animado */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 80%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(245, 87, 108, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(79, 172, 254, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
            animation: backgroundShift 20s ease-in-out infinite;
        }

        @keyframes backgroundShift {
            0%, 100% { transform: translateX(0) translateY(0); }
            33% { transform: translateX(-10px) translateY(10px); }
            66% { transform: translateX(10px) translateY(-10px); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
            position: relative;
        }

        /* Header Ultra Moderno */
        .header {
            text-align: center;
            margin-bottom: 48px;
            background: var(--card-bg);
            padding: 48px;
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border-primary);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        .header-icon {
            font-size: 4rem;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            display: block;
            filter: drop-shadow(0 4px 8px rgba(79, 172, 254, 0.3));
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 900;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
            letter-spacing: -0.025em;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.3rem;
            font-weight: 400;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Navegación Premium */
        .tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 40px;
            background: var(--bg-secondary);
            padding: 8px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-primary);
            position: relative;
        }

        .tab-button {
            padding: 16px 28px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition-normal);
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
        }

        .tab-button:hover {
            background: rgba(102, 126, 234, 0.15);
            color: var(--text-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .tab-button.active {
            background: var(--primary-gradient);
            color: white;
            box-shadow: var(--shadow-glow);
            transform: translateY(-1px);
        }

        /* Contenido de pestañas */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: tabAppear 0.5s ease-out;
        }

        @keyframes tabAppear {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Secciones principales */
        .search-section,
        .add-section,
        .all-providers-section,
        .tree-section {
            background: var(--card-bg);
            padding: 40px;
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border-primary);
            position: relative;
            backdrop-filter: blur(10px);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 2px solid var(--border-primary);
            position: relative;
        }

        .section-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 80px;
            height: 2px;
            background: var(--accent-gradient);
            border-radius: 1px;
        }

        .section-icon {
            font-size: 1.8rem;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 2px 4px rgba(79, 172, 254, 0.3));
        }

        .section-header h2 {
            color: var(--text-primary);
            font-size: 1.8rem;
            font-weight: 800;
            letter-spacing: -0.02em;
        }

        /* Estilos específicos para visualización del árbol */
        .tree-container {
            width: 100%;
            min-height: 600px;
            background: var(--bg-secondary);
            border-radius: var(--border-radius-lg);
            border: 2px solid var(--border-primary);
            padding: 30px;
            overflow: auto;
            position: relative;
        }

        .tree-canvas {
            position: relative;
            min-height: 500px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .tree-node {
            background: var(--node-bg);
            border: 2px solid var(--node-border);
            border-radius: var(--border-radius-md);
            padding: 15px 20px;
            margin: 10px;
            min-width: 80px;
            text-align: center;
            position: relative;
            transition: var(--transition-normal);
            box-shadow: var(--shadow-md);
        }

        .tree-node:hover {
            background: var(--node-hover);
            border-color: var(--highlight-color);
            box-shadow: var(--shadow-lg), 0 0 15px rgba(79, 172, 254, 0.3);
            transform: translateY(-2px);
        }

        .tree-node.inserting {
            animation: nodeInsert 0.8s ease-out;
            border-color: var(--insertion-color);
            box-shadow: 0 0 20px rgba(0, 212, 170, 0.5);
        }

        .tree-node.splitting {
            animation: nodeSplit 1s ease-out;
            border-color: var(--split-color);
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.5);
        }

        @keyframes nodeInsert {
            0% {
                transform: scale(0.5) rotate(-10deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.1) rotate(5deg);
                opacity: 0.8;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        @keyframes nodeSplit {
            0% { transform: scale(1); }
            25% {
                transform: scale(1.1);
                background: linear-gradient(145deg, #ff6b6b, #ee5a52);
            }
            50% {
                transform: scale(0.95) rotateX(10deg);
            }
            75% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1) rotateX(0deg);
            }
        }

        .node-key {
            background: var(--primary-gradient);
            color: white;
            padding: 8px 12px;
            border-radius: var(--border-radius-sm);
            margin: 2px;
            display: inline-block;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: var(--shadow-sm);
            transition: var(--transition-fast);
        }

        .node-key:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }

        .node-level {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px 0;
            flex-wrap: wrap;
            gap: 20px;
        }

        .connection-line {
            position: absolute;
            background: var(--connection-color);
            height: 2px;
            z-index: 1;
            opacity: 0.7;
            transition: var(--transition-normal);
        }

        .connection-line::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, transparent, var(--highlight-color), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .connection-line:hover::before {
            opacity: 1;
        }

        /* Controles del árbol */
        .tree-controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            padding: 20px;
            background: var(--bg-tertiary);
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--border-primary);
            box-shadow: var(--shadow-md);
            flex-wrap: wrap;
            align-items: center;
        }

        .tree-control-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .tree-control-group label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tree-control-group input,
        .tree-control-group select {
            padding: 10px 16px;
            border: 2px solid var(--border-primary);
            border-radius: var(--border-radius-sm);
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: var(--transition-normal);
            font-weight: 500;
        }

        .tree-control-group input:focus,
        .tree-control-group select:focus {
            outline: none;
            border-color: var(--border-accent);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        /* Información del árbol */
        .tree-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .info-card {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: var(--border-radius-md);
            border: 1px solid var(--border-primary);
            text-align: center;
            transition: var(--transition-normal);
        }

        .info-card:hover {
            border-color: var(--border-accent);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .info-card-icon {
            font-size: 2rem;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            display: block;
        }

        .info-card-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .info-card-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Formularios modernos */
        .search-form,
        .provider-form {
            display: grid;
            gap: 28px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: relative;
        }

        .form-group label {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group label i {
            color: var(--text-accent);
        }

        .form-group input,
        .form-group select {
            padding: 16px 20px;
            border: 2px solid var(--border-primary);
            border-radius: var(--border-radius-md);
            font-size: 1rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: var(--transition-normal);
            font-weight: 500;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--border-accent);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
            background: var(--bg-primary);
            transform: translateY(-1px);
        }

        /* Botones premium */
        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: var(--border-radius-md);
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition-normal);
            font-size: 1rem;
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-height: 52px;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg), var(--shadow-glow);
        }

        .btn-secondary {
            background: var(--secondary-gradient);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .btn-accent {
            background: var(--accent-gradient);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-accent:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg), var(--shadow-glow-cyan);
        }

        /* Tarjetas de proveedores */
        .provider-card {
            background: var(--card-bg);
            border: 2px solid var(--border-primary);
            border-radius: var(--border-radius-lg);
            padding: 28px;
            margin-bottom: 24px;
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .provider-card:hover {
            border-color: var(--border-accent);
            box-shadow: var(--shadow-xl), var(--shadow-glow-cyan);
            transform: translateY(-6px);
            background: var(--card-bg-hover);
        }

        .provider-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .provider-name {
            color: var(--text-primary);
            font-size: 1.4rem;
            font-weight: 800;
            margin-bottom: 6px;
            letter-spacing: -0.02em;
        }

        .provider-id {
            background: var(--primary-gradient);
            color: white;
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 700;
            box-shadow: var(--shadow-sm);
            letter-spacing: 0.5px;
        }

        .provider-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .provider-detail {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-secondary);
            font-size: 0.95rem;
            font-weight: 500;
        }

        .provider-detail i {
            width: 18px;
            color: var(--text-accent);
        }

        .provider-rating {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(102, 126, 234, 0.15);
            padding: 14px 20px;
            border-radius: var(--border-radius-md);
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        .stars {
            display: flex;
            gap: 3px;
        }

        .star {
            color: #fbbf24;
            font-size: 1.2rem;
            filter: drop-shadow(0 1px 2px rgba(251, 191, 36, 0.3));
        }

        .rating-value {
            font-weight: 800;
            font-size: 1.2rem;
            color: var(--text-primary);
        }

        /* Opciones de búsqueda */
        .search-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 28px;
            margin-bottom: 40px;
        }

        .search-card {
            background: var(--bg-secondary);
            padding: 28px;
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--border-primary);
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .search-card:hover {
            border-color: var(--border-accent);
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
            background: var(--bg-tertiary);
        }

        .search-card-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 20px;
        }

        .search-card-icon {
            font-size: 1.4rem;
            color: var(--text-accent);
        }

        .search-card h3 {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Grid de proveedores */
        .providers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 28px;
            margin-top: 28px;
        }

        /* Estados vacíos */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 5rem;
            color: var(--border-secondary);
            margin-bottom: 24px;
            display: block;
            opacity: 0.6;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 12px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* Mensajes */
        .message {
            position: fixed;
            top: 28px;
            right: 28px;
            padding: 18px 28px;
            border-radius: var(--border-radius-md);
            color: white;
            font-weight: 700;
            z-index: 1000;
            animation: messageSlide 0.5s ease-out;
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 12px;
            backdrop-filter: blur(10px);
            max-width: 400px;
        }

        .message.success { background: var(--success-gradient); }
        .message.error { background: var(--error-gradient); }
        .message.warning { background: var(--warning-gradient); }

        @keyframes messageSlide {
            from { transform: translateX(100%) scale(0.8); opacity: 0; }
            to { transform: translateX(0) scale(1); opacity: 1; }
        }

        .hidden { display: none !important; }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 16px; }
            .header { padding: 32px 24px; margin-bottom: 32px; }
            .header h1 { font-size: 2.5rem; }
            .tabs { flex-direction: column; gap: 4px; }
            .tab-button { flex: none; justify-content: flex-start; padding: 14px 20px; }
            .search-options { grid-template-columns: 1fr; gap: 20px; }
            .form-row { grid-template-columns: 1fr; gap: 16px; }
            .providers-grid { grid-template-columns: 1fr; gap: 16px; }
            .tree-controls { flex-direction: column; align-items: stretch; }
            .tree-info { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 480px) {
            .search-section, .add-section, .all-providers-section, .tree-section { padding: 24px; }
            .tree-info { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <i class="fas fa-network-wired header-icon"></i>
            <h1>ServiceConnect</h1>
            <p>Plataforma inteligente de servicios locales con visualización de Árbol B</p>
        </header>

        <main class="main-content">
            <!-- Navegación -->
            <div class="tabs">
                <button class="tab-button active" onclick="showTab('buscar')">
                    <i class="fas fa-search"></i>
                    Buscar Proveedores
                </button>
                <button class="tab-button" onclick="showTab('agregar')">
                    <i class="fas fa-plus-circle"></i>
                    Agregar Proveedor
                </button>
                <button class="tab-button" onclick="showTab('arbol')">
                    <i class="fas fa-project-diagram"></i>
                    Visualizar Árbol B
                </button>
                <button class="tab-button" onclick="showTab('todos')">
                    <i class="fas fa-list"></i>
                    Todos los Proveedores
                </button>
            </div>

            <!-- Pestaña Buscar -->
            <div id="buscar" class="tab-content active">
                <div class="search-section">
                    <div class="section-header">
                        <i class="fas fa-search section-icon"></i>
                        <h2>Buscar Proveedores</h2>
                    </div>

                    <div class="search-options">
                        <div class="search-card">
                            <div class="search-card-header">
                                <i class="fas fa-tools search-card-icon"></i>
                                <h3>Buscar por Servicio</h3>
                            </div>
                            <div class="form-group">
                                <label>Tipo de Servicio:</label>
                                <select id="servicioSelect">
                                    <option value="">Seleccione un servicio</option>
                                </select>
                                <button class="btn btn-primary" onclick="buscarPorServicio()">
                                    <i class="fas fa-search"></i>
                                    Buscar
                                </button>
                            </div>
                        </div>

                        <div class="search-card">
                            <div class="search-card-header">
                                <i class="fas fa-id-card search-card-icon"></i>
                                <h3>Buscar por ID</h3>
                            </div>
                            <div class="form-group">
                                <label>ID del Proveedor:</label>
                                <input type="number" id="idInput" placeholder="Ingrese ID">
                                <button class="btn btn-primary" onclick="buscarPorId()">
                                    <i class="fas fa-search"></i>
                                    Buscar
                                </button>
                            </div>
                        </div>

                        <div class="search-card">
                            <div class="search-card-header">
                                <i class="fas fa-map-marker-alt search-card-icon"></i>
                                <h3>Buscar por Ubicación</h3>
                            </div>
                            <div class="form-group">
                                <label>Ubicación:</label>
                                <select id="ubicacionSelect">
                                    <option value="">Seleccione una ubicación</option>
                                </select>
                                <button class="btn btn-primary" onclick="buscarPorUbicacion()">
                                    <i class="fas fa-search"></i>
                                    Buscar
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="resultadosBusqueda" class="search-results"></div>
                </div>
            </div>

            <!-- Pestaña Agregar -->
            <div id="agregar" class="tab-content">
                <div class="add-section">
                    <div class="section-header">
                        <i class="fas fa-plus-circle section-icon"></i>
                        <h2>Agregar Nuevo Proveedor</h2>
                    </div>

                    <form id="proveedorForm" class="provider-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nuevoId">
                                    <i class="fas fa-hashtag"></i>
                                    ID Único:
                                </label>
                                <input type="number" id="nuevoId" required placeholder="Ej: 1001">
                            </div>

                            <div class="form-group">
                                <label for="nuevoNombre">
                                    <i class="fas fa-user"></i>
                                    Nombre Completo:
                                </label>
                                <input type="text" id="nuevoNombre" required placeholder="Ej: Juan Pérez">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="nuevoServicio">
                                    <i class="fas fa-briefcase"></i>
                                    Tipo de Servicio:
                                </label>
                                <input type="text" id="nuevoServicio" required placeholder="Ej: electricista, programador, diseñador">
                            </div>

                            <div class="form-group">
                                <label for="nuevaUbicacion">
                                    <i class="fas fa-map-marker-alt"></i>
                                    Ubicación:
                                </label>
                                <input type="text" id="nuevaUbicacion" required placeholder="Ej: Zona 10, Guatemala">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="nuevaCalificacion">
                                    <i class="fas fa-star"></i>
                                    Calificación (1-5):
                                </label>
                                <input type="number" id="nuevaCalificacion" min="1" max="5" step="0.1" required placeholder="4.5">
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Agregar Proveedor
                        </button>
                    </form>
                </div>
            </div>

            <!-- Pestaña Visualización del Árbol B -->
            <div id="arbol" class="tab-content">
                <div class="tree-section">
                    <div class="section-header">
                        <i class="fas fa-project-diagram section-icon"></i>
                        <h2>Visualización del Árbol B</h2>
                    </div>

                    <!-- Información del árbol -->
                    <div class="tree-info">
                        <div class="info-card">
                            <i class="fas fa-sitemap info-card-icon"></i>
                            <div class="info-card-value" id="totalNodos">0</div>
                            <div class="info-card-label">Nodos Totales</div>
                        </div>
                        <div class="info-card">
                            <i class="fas fa-users info-card-icon"></i>
                            <div class="info-card-value" id="totalProveedores">0</div>
                            <div class="info-card-label">Proveedores</div>
                        </div>
                        <div class="info-card">
                            <i class="fas fa-layer-group info-card-icon"></i>
                            <div class="info-card-value" id="alturaArbol">0</div>
                            <div class="info-card-label">Altura</div>
                        </div>
                        <div class="info-card">
                            <i class="fas fa-cogs info-card-icon"></i>
                            <div class="info-card-value" id="gradoArbol">3</div>
                            <div class="info-card-label">Grado</div>
                        </div>
                    </div>

                    <!-- Controles del árbol -->
                    <div class="tree-controls">
                        <div class="tree-control-group">
                            <label>Insertar ID:</label>
                            <input type="number" id="insertId" placeholder="ID">
                            <input type="text" id="insertNombre" placeholder="Nombre">
                            <button class="btn btn-accent" onclick="insertarConVisualizacion()">
                                <i class="fas fa-plus"></i>
                                Insertar
                            </button>
                        </div>
                        <div class="tree-control-group">
                            <button class="btn btn-secondary" onclick="actualizarVisualizacion()">
                                <i class="fas fa-sync-alt"></i>
                                Actualizar Vista
                            </button>
                            <button class="btn btn-secondary" onclick="limpiarArbol()">
                                <i class="fas fa-trash"></i>
                                Limpiar Árbol
                            </button>
                        </div>
                    </div>

                    <!-- Canvas del árbol -->
                    <div class="tree-container">
                        <div id="treeCanvas" class="tree-canvas">
                            <div class="empty-state">
                                <i class="fas fa-sitemap"></i>
                                <h3>Árbol B Vacío</h3>
                                <p>Agrega proveedores para ver la estructura del árbol</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pestaña Todos -->
            <div id="todos" class="tab-content">
                <div class="all-providers-section">
                    <div class="section-header">
                        <i class="fas fa-list section-icon"></i>
                        <h2>Directorio de Proveedores</h2>
                    </div>

                    <div class="sort-controls">
                        <label>
                            <i class="fas fa-sort"></i>
                            Ordenar por:
                        </label>
                        <select id="ordenSelect" onchange="cargarTodosProveedores()">
                            <option value="nombre">Nombre</option>
                            <option value="calificacion">Calificación</option>
                            <option value="ubicacion">Ubicación</option>
                        </select>
                        <button class="btn btn-secondary" onclick="cargarTodosProveedores()">
                            <i class="fas fa-sync-alt"></i>
                            Actualizar
                        </button>
                    </div>

                    <div id="todosProveedores" class="providers-grid"></div>
                </div>
            </div>
        </main>

        <!-- Loading -->
        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p>Procesando solicitud...</p>
        </div>

        <div id="mensaje" class="message hidden"></div>
    </div>

    <script>
        // Variables globales
        let proveedoresData = [];
        let serviciosUnicos = [];
        let ubicacionesUnicas = [];
        let arbolVisualizacion = null;

        // Clase para simular el Árbol B en el frontend
        class ArbolBVisual {
            constructor(grado = 3) {
                this.grado = grado;
                this.raiz = { claves: [], datos: [], hijos: [], es_hoja: true };
            }

            insertar(clave, datos) {
                if (this.estaLleno(this.raiz)) {
                    const nuevaRaiz = { claves: [], datos: [], hijos: [this.raiz], es_hoja: false };
                    this.dividirHijo(nuevaRaiz, 0);
                    this.raiz = nuevaRaiz;
                }
                this.insertarNoLleno(this.raiz, clave, datos);
            }

            estaLleno(nodo) {
                return nodo.claves.length === 2 * this.grado - 1;
            }

            insertarNoLleno(nodo, clave, datos) {
                let i = nodo.claves.length - 1;

                if (nodo.es_hoja) {
                    nodo.claves.push(null);
                    nodo.datos.push(null);

                    while (i >= 0 && clave < nodo.claves[i]) {
                        nodo.claves[i + 1] = nodo.claves[i];
                        nodo.datos[i + 1] = nodo.datos[i];
                        i--;
                    }

                    nodo.claves[i + 1] = clave;
                    nodo.datos[i + 1] = datos;
                } else {
                    while (i >= 0 && clave < nodo.claves[i]) {
                        i--;
                    }
                    i++;

                    if (this.estaLleno(nodo.hijos[i])) {
                        this.dividirHijo(nodo, i);
                        if (clave > nodo.claves[i]) {
                            i++;
                        }
                    }

                    this.insertarNoLleno(nodo.hijos[i], clave, datos);
                }
            }

            dividirHijo(nodoPadre, indice) {
                const nodoLleno = nodoPadre.hijos[indice];
                const nuevoNodo = {
                    claves: [],
                    datos: [],
                    hijos: [],
                    es_hoja: nodoLleno.es_hoja
                };

                const grado = this.grado;

                // Mover mitad de claves al nuevo nodo
                nuevoNodo.claves = nodoLleno.claves.splice(grado);
                nuevoNodo.datos = nodoLleno.datos.splice(grado);

                // Si no es hoja, mover hijos también
                if (!nodoLleno.es_hoja) {
                    nuevoNodo.hijos = nodoLleno.hijos.splice(grado);
                }

                // Subir clave media al padre
                const claveMedia = nodoLleno.claves.pop();
                const datosMedia = nodoLleno.datos.pop();

                nodoPadre.hijos.splice(indice + 1, 0, nuevoNodo);
                nodoPadre.claves.splice(indice, 0, claveMedia);
                nodoPadre.datos.splice(indice, 0, datosMedia);
            }

            buscar(clave) {
                return this.buscarEnNodo(this.raiz, clave);
            }

            buscarEnNodo(nodo, clave) {
                let i = 0;
                while (i < nodo.claves.length && clave > nodo.claves[i]) {
                    i++;
                }

                if (i < nodo.claves.length && clave === nodo.claves[i]) {
                    return nodo.datos[i];
                }

                if (nodo.es_hoja) {
                    return null;
                }

                return this.buscarEnNodo(nodo.hijos[i], clave);
            }

            limpiar() {
                this.raiz = { claves: [], datos: [], hijos: [], es_hoja: true };
            }
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            arbolVisualizacion = new ArbolBVisual(3);
            cargarServiciosUnicos();
            cargarUbicacionesUnicas();
            cargarTodosProveedores();
            configurarFormulario();
            showTab('buscar');

            // Cargar datos iniciales en el árbol visual
            setTimeout(() => {
                cargarDatosEnArbolVisual();
            }, 1000);
        });

        // Gestión de pestañas
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'todos') {
                cargarTodosProveedores();
            } else if (tabName === 'arbol') {
                actualizarVisualizacion();
            }
        }

        // Funciones del árbol visual
        function cargarDatosEnArbolVisual() {
            // Datos de ejemplo para el árbol
            const datosEjemplo = [
                {id: 100, nombre: "Carlos López", servicio: "electricista", calificacion: 4.5, ubicacion: "Zona 1"},
                {id: 200, nombre: "Ana García", servicio: "programador", calificacion: 4.8, ubicacion: "Zona 10"},
                {id: 150, nombre: "Pedro Martínez", servicio: "plomero", calificacion: 4.2, ubicacion: "Zona 5"},
                {id: 300, nombre: "Laura Rodríguez", servicio: "diseñador", calificacion: 4.9, ubicacion: "Zona 14"},
                {id: 50, nombre: "Roberto Silva", servicio: "electricista", calificacion: 4.1, ubicacion: "Zona 3"},
                {id: 250, nombre: "María Torres", servicio: "programador", calificacion: 4.7, ubicacion: "Zona 12"},
                {id: 400, nombre: "Diego Morales", servicio: "arquitecto", calificacion: 4.6, ubicacion: "Zona 15"},
                {id: 75, nombre: "Carmen Vega", servicio: "contador", calificacion: 4.3, ubicacion: "Zona 4"}
            ];

            // Insertar datos en el árbol visual
            datosEjemplo.forEach((datos, index) => {
                setTimeout(() => {
                    arbolVisualizacion.insertar(datos.id, datos);
                    if (document.getElementById('arbol').classList.contains('active')) {
                        actualizarVisualizacion();
                    }
                }, index * 300);
            });
        }

        function insertarConVisualizacion() {
            const id = parseInt(document.getElementById('insertId').value);
            const nombre = document.getElementById('insertNombre').value.trim();

            if (!id || !nombre) {
                showMessage('Por favor ingrese ID y nombre', 'warning');
                return;
            }

            if (arbolVisualizacion.buscar(id)) {
                showMessage('El ID ya existe en el árbol', 'error');
                return;
            }

            const datos = {
                id: id,
                nombre: nombre,
                servicio: "demo",
                calificacion: 4.0,
                ubicacion: "Demo"
            };

            // Insertar con animación
            arbolVisualizacion.insertar(id, datos);
            showMessage(`Proveedor ${nombre} (ID: ${id}) insertado`, 'success');

            // Actualizar visualización
            setTimeout(() => {
                actualizarVisualizacion();
                document.getElementById('insertId').value = '';
                document.getElementById('insertNombre').value = '';
            }, 100);
        }

        function actualizarVisualizacion() {
            const canvas = document.getElementById('treeCanvas');

            if (!arbolVisualizacion || arbolVisualizacion.raiz.claves.length === 0) {
                canvas.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-sitemap"></i>
                        <h3>Árbol B Vacío</h3>
                        <p>Inserta elementos para ver la estructura del árbol</p>
                    </div>
                `;
                actualizarEstadisticas();
                return;
            }

            canvas.innerHTML = '';
            dibujarArbol(arbolVisualizacion.raiz, canvas, 0, 0);
            actualizarEstadisticas();
        }

        function dibujarArbol(nodo, container, nivel, posicion) {
            if (!nodo || nodo.claves.length === 0) return;

            // Crear nivel si no existe
            let nivelDiv = container.querySelector(`[data-nivel="${nivel}"]`);
            if (!nivelDiv) {
                nivelDiv = document.createElement('div');
                nivelDiv.className = 'node-level';
                nivelDiv.setAttribute('data-nivel', nivel);
                container.appendChild(nivelDiv);
            }

            // Crear nodo visual
            const nodoDiv = document.createElement('div');
            nodoDiv.className = 'tree-node';
            nodoDiv.setAttribute('data-posicion', posicion);

            // Agregar claves al nodo
            nodo.claves.forEach((clave, index) => {
                const claveSpan = document.createElement('span');
                claveSpan.className = 'node-key';
                claveSpan.textContent = clave;
                claveSpan.title = `${nodo.datos[index].nombre} - ${nodo.datos[index].servicio}`;
                nodoDiv.appendChild(claveSpan);
            });

            // Agregar indicador de hoja
            if (nodo.es_hoja) {
                const hojaIcon = document.createElement('i');
                hojaIcon.className = 'fas fa-leaf';
                hojaIcon.style.color = 'var(--success-color)';
                hojaIcon.style.marginLeft = '8px';
                hojaIcon.style.fontSize = '0.8rem';
                nodoDiv.appendChild(hojaIcon);
            }

            nivelDiv.appendChild(nodoDiv);

            // Animación de inserción para nodos nuevos
            setTimeout(() => {
                nodoDiv.classList.add('inserting');
                setTimeout(() => {
                    nodoDiv.classList.remove('inserting');
                }, 800);
            }, 100);

            // Dibujar hijos recursivamente
            if (!nodo.es_hoja && nodo.hijos) {
                nodo.hijos.forEach((hijo, index) => {
                    dibujarArbol(hijo, container, nivel + 1, posicion * 10 + index);
                });
            }
        }

        function actualizarEstadisticas() {
            const stats = calcularEstadisticasArbol();
            document.getElementById('totalNodos').textContent = stats.totalNodos;
            document.getElementById('totalProveedores').textContent = stats.totalProveedores;
            document.getElementById('alturaArbol').textContent = stats.altura;
            document.getElementById('gradoArbol').textContent = arbolVisualizacion.grado;
        }

        function calcularEstadisticasArbol() {
            if (!arbolVisualizacion) {
                return { totalNodos: 0, totalProveedores: 0, altura: 0 };
            }

            const totalNodos = contarNodos(arbolVisualizacion.raiz);
            const totalProveedores = contarProveedores(arbolVisualizacion.raiz);
            const altura = calcularAltura(arbolVisualizacion.raiz);

            return { totalNodos, totalProveedores, altura };
        }

        function contarNodos(nodo) {
            if (!nodo || nodo.claves.length === 0) return 0;

            let total = 1;
            if (!nodo.es_hoja && nodo.hijos) {
                nodo.hijos.forEach(hijo => {
                    total += contarNodos(hijo);
                });
            }
            return total;
        }

        function contarProveedores(nodo) {
            if (!nodo) return 0;

            let total = nodo.claves.length;
            if (!nodo.es_hoja && nodo.hijos) {
                nodo.hijos.forEach(hijo => {
                    total += contarProveedores(hijo);
                });
            }
            return total;
        }

        function calcularAltura(nodo) {
            if (!nodo || nodo.claves.length === 0) return 0;

            if (nodo.es_hoja) return 1;

            if (nodo.hijos && nodo.hijos.length > 0) {
                return 1 + calcularAltura(nodo.hijos[0]);
            }
            return 1;
        }

        function limpiarArbol() {
            if (confirm('¿Estás seguro de que quieres limpiar todo el árbol?')) {
                arbolVisualizacion.limpiar();
                actualizarVisualizacion();
                showMessage('Árbol limpiado', 'success');
            }
        }

        // Funciones originales del sistema
        async function cargarServiciosUnicos() {
            try {
                serviciosUnicos = ['electricista', 'programador', 'diseñador', 'plomero', 'arquitecto', 'contador'];
                const servicioSelect = document.getElementById('servicioSelect');
                servicioSelect.innerHTML = '<option value="">Seleccione un servicio</option>';

                serviciosUnicos.forEach(servicio => {
                    const option = new Option(servicio.charAt(0).toUpperCase() + servicio.slice(1), servicio);
                    servicioSelect.add(option);
                });
            } catch (error) {
                console.error('Error cargando servicios:', error);
            }
        }

        async function cargarUbicacionesUnicas() {
            try {
                ubicacionesUnicas = ['Zona 1', 'Zona 3', 'Zona 4', 'Zona 5', 'Zona 10', 'Zona 12', 'Zona 14', 'Zona 15'];
                const ubicacionSelect = document.getElementById('ubicacionSelect');
                ubicacionSelect.innerHTML = '<option value="">Seleccione una ubicación</option>';

                ubicacionesUnicas.forEach(ubicacion => {
                    const option = new Option(ubicacion, ubicacion);
                    ubicacionSelect.add(option);
                });
            } catch (error) {
                console.error('Error cargando ubicaciones:', error);
            }
        }

        function buscarPorServicio() {
            const servicio = document.getElementById('servicioSelect').value;
            if (!servicio) {
                showMessage('Por favor seleccione un tipo de servicio', 'warning');
                return;
            }

            // Simular búsqueda
            const resultados = buscarEnArbol(arbolVisualizacion.raiz, 'servicio', servicio);
            mostrarResultadosBusqueda(resultados, {
                tiempo: Math.random() * 10 + 5,
                total: resultados.length,
                tipo: 'servicio',
                termino: servicio
            });
        }

        function buscarPorId() {
            const id = parseInt(document.getElementById('idInput').value);
            if (!id) {
                showMessage('Por favor ingrese un ID', 'warning');
                return;
            }

            const resultado = arbolVisualizacion.buscar(id);
            if (resultado) {
                mostrarResultadosBusqueda([resultado], {
                    tiempo: Math.random() * 5 + 2,
                    total: 1,
                    tipo: 'ID',
                    termino: id
                });
            } else {
                mostrarResultadosBusqueda([], {
                    tiempo: Math.random() * 5 + 2,
                    total: 0,
                    tipo: 'ID',
                    termino: id
                });
            }
        }

        function buscarPorUbicacion() {
            const ubicacion = document.getElementById('ubicacionSelect').value;
            if (!ubicacion) {
                showMessage('Por favor seleccione una ubicación', 'warning');
                return;
            }

            const resultados = buscarEnArbol(arbolVisualizacion.raiz, 'ubicacion', ubicacion);
            mostrarResultadosBusqueda(resultados, {
                tiempo: Math.random() * 10 + 5,
                total: resultados.length,
                tipo: 'ubicación',
                termino: ubicacion
            });
        }

        function buscarEnArbol(nodo, campo, valor) {
            let resultados = [];

            // Buscar en el nodo actual
            nodo.datos.forEach(datos => {
                if (datos[campo].toLowerCase() === valor.toLowerCase()) {
                    resultados.push(datos);
                }
            });

            // Buscar en hijos si no es hoja
            if (!nodo.es_hoja && nodo.hijos) {
                nodo.hijos.forEach(hijo => {
                    resultados = resultados.concat(buscarEnArbol(hijo, campo, valor));
                });
            }

            return resultados;
        }

        function mostrarResultadosBusqueda(resultados, metadata) {
            const container = document.getElementById('resultadosBusqueda');

            let html = `
                <div class="search-metadata">
                    <h3>
                        <i class="fas fa-search-location"></i>
                        Resultados de búsqueda por ${metadata.tipo}
                    </h3>
                    <div class="search-stats">
                        <div class="search-stat">
                            <i class="fas fa-bullseye"></i>
                            Término: <strong>"${metadata.termino}"</strong>
                        </div>
                        <div class="search-stat">
                            <i class="fas fa-users"></i>
                            Encontrados: <strong>${metadata.total}</strong>
                        </div>
                        <div class="search-stat">
                            <i class="fas fa-clock"></i>
                            Tiempo: <strong>${metadata.tiempo.toFixed(2)} ms</strong>
                        </div>
                    </div>
                </div>
            `;

            if (resultados.length === 0) {
                html += `
                    <div class="empty-state">
                        <i class="fas fa-search-minus"></i>
                        <h3>No se encontraron resultados</h3>
                        <p>Intenta con diferentes términos de búsqueda</p>
                    </div>
                `;
            } else {
                html += '<div class="providers-grid">';
                resultados.forEach(proveedor => {
                    html += crearTarjetaProveedor(proveedor);
                });
                html += '</div>';
            }

            container.innerHTML = html;
        }

        function crearTarjetaProveedor(proveedor) {
            const estrellas = generarEstrellas(proveedor.calificacion);

            return `
                <div class="provider-card">
                    <div class="provider-header">
                        <div>
                            <div class="provider-name">${proveedor.nombre}</div>
                        </div>
                        <div class="provider-id">ID: ${proveedor.id}</div>
                    </div>

                    <div class="provider-details">
                        <div class="provider-detail">
                            <i class="fas fa-briefcase"></i>
                            <span>${proveedor.servicio}</span>
                        </div>
                        <div class="provider-detail">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${proveedor.ubicacion}</span>
                        </div>
                    </div>

                    <div class="provider-rating">
                        <div class="stars">${estrellas}</div>
                        <div class="rating-value">${proveedor.calificacion}/5</div>
                    </div>
                </div>
            `;
        }

        function generarEstrellas(calificacion) {
            let estrellas = '';
            const calificacionRedondeada = Math.round(calificacion * 2) / 2;

            for (let i = 1; i <= 5; i++) {
                if (i <= calificacionRedondeada) {
                    estrellas += '<i class="fas fa-star star"></i>';
                } else if (i - 0.5 <= calificacionRedondeada) {
                    estrellas += '<i class="fas fa-star-half-alt star"></i>';
                } else {
                    estrellas += '<i class="far fa-star star"></i>';
                }
            }

            return estrellas;
        }

        function configurarFormulario() {
            const form = document.getElementById('proveedorForm');
            form.addEventListener('submit', async function(e) {
                e.preventDefault();

                const formData = {
                    id: parseInt(document.getElementById('nuevoId').value),
                    nombre: document.getElementById('nuevoNombre').value.trim(),
                    servicio: document.getElementById('nuevoServicio').value.trim().toLowerCase(),
                    calificacion: parseFloat(document.getElementById('nuevaCalificacion').value),
                    ubicacion: document.getElementById('nuevaUbicacion').value.trim()
                };

                if (!formData.nombre || !formData.servicio || !formData.ubicacion) {
                    showMessage('Por favor complete todos los campos', 'warning');
                    return;
                }

                if (formData.calificacion < 1 || formData.calificacion > 5) {
                    showMessage('La calificación debe estar entre 1 y 5', 'warning');
                    return;
                }

                if (arbolVisualizacion.buscar(formData.id)) {
                    showMessage('El ID ya existe', 'error');
                    return;
                }

                // Insertar en el árbol visual con animación
                arbolVisualizacion.insertar(formData.id, formData);
                showMessage('Proveedor agregado exitosamente', 'success');
                form.reset();

                // Actualizar listas
                if (!serviciosUnicos.includes(formData.servicio)) {
                    serviciosUnicos.push(formData.servicio);
                    cargarServiciosUnicos();
                }
                if (!ubicacionesUnicas.includes(formData.ubicacion)) {
                    ubicacionesUnicas.push(formData.ubicacion);
                    cargarUbicacionesUnicas();
                }

                // Actualizar vista del árbol si está activa
                if (document.getElementById('arbol').classList.contains('active')) {
                    setTimeout(() => actualizarVisualizacion(), 200);
                }
            });
        }

        async function cargarTodosProveedores() {
            const container = document.getElementById('todosProveedores');
            const orden = document.getElementById('ordenSelect')?.value || 'nombre';

            // Obtener todos los proveedores del árbol visual
            const proveedores = obtenerTodosProveedores();

            if (proveedores.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users-slash"></i>
                        <h3>No hay proveedores registrados</h3>
                        <p>Agrega el primer proveedor para comenzar</p>
                    </div>
                `;
                return;
            }

            // Ordenar proveedores
            if (orden === 'nombre') {
                proveedores.sort((a, b) => a.nombre.localeCompare(b.nombre));
            } else if (orden === 'calificacion') {
                proveedores.sort((a, b) => b.calificacion - a.calificacion);
            } else if (orden === 'ubicacion') {
                proveedores.sort((a, b) => a.ubicacion.localeCompare(b.ubicacion));
            }

            let html = '';
            proveedores.forEach(proveedor => {
                html += crearTarjetaProveedor(proveedor);
            });

            container.innerHTML = html;
            proveedoresData = proveedores;
        }

        function obtenerTodosProveedores() {
            const proveedores = [];
            recorrerArbolInorden(arbolVisualizacion.raiz, proveedores);
            return proveedores;
        }

        function recorrerArbolInorden(nodo, resultado) {
            if (!nodo || nodo.claves.length === 0) return;

            if (nodo.es_hoja) {
                nodo.datos.forEach(datos => {
                    resultado.push(datos);
                });
            } else {
                for (let i = 0; i < nodo.claves.length; i++) {
                    if (nodo.hijos[i]) {
                        recorrerArbolInorden(nodo.hijos[i], resultado);
                    }
                    resultado.push(nodo.datos[i]);
                }
                if (nodo.hijos[nodo.hijos.length - 1]) {
                    recorrerArbolInorden(nodo.hijos[nodo.hijos.length - 1], resultado);
                }
            }
        }

        // Utilidades
        function showMessage(message, type = 'success') {
            const messageDiv = document.getElementById('mensaje');

            let icon = '';
            switch(type) {
                case 'success':
                    icon = '<i class="fas fa-check-circle"></i>';
                    break;
                case 'error':
                    icon = '<i class="fas fa-exclamation-circle"></i>';
                    break;
                case 'warning':
                    icon = '<i class="fas fa-exclamation-triangle"></i>';
                    break;
            }

            messageDiv.innerHTML = `${icon} ${message}`;
            messageDiv.className = `message ${type}`;
            messageDiv.classList.remove('hidden');

            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 5000);
        }

        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        // Efectos visuales mejorados
        document.addEventListener('mousemove', function(e) {
            const cards = document.querySelectorAll('.provider-card');
            cards.forEach(card => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                if (x >= 0 && x <= rect.width && y >= 0 && y <= rect.height) {
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;
                    const rotateX = (y - centerY) / 20;
                    const rotateY = (centerX - x) / 20;

                    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateY(-6px)`;
                } else {
                    card.style.transform = '';
                }
            });
        });

        // Agregar estilos restantes para completar la visualización
        const additionalStyles = `
            .sort-controls {
                display: flex;
                align-items: center;
                gap: 20px;
                margin-bottom: 28px;
                padding: 24px;
                background: var(--bg-secondary);
                border-radius: var(--border-radius-lg);
                border: 1px solid var(--border-primary);
                box-shadow: var(--shadow-md);
            }

            .sort-controls label {
                font-weight: 700;
                color: var(--text-primary);
                display: flex;
                align-items: center;
                gap: 8px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                font-size: 0.9rem;
            }

            .search-results {
                margin-top: 40px;
            }

            .search-metadata {
                background: var(--bg-secondary);
                padding: 24px;
                border-radius: var(--border-radius-lg);
                border: 1px solid var(--border-primary);
                margin-bottom: 28px;
                box-shadow: var(--shadow-md);
            }

            .search-metadata h3 {
                color: var(--text-primary);
                font-size: 1.3rem;
                font-weight: 700;
                margin-bottom: 12px;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .search-stats {
                display: flex;
                gap: 32px;
                color: var(--text-secondary);
                font-size: 0.95rem;
                flex-wrap: wrap;
            }

            .search-stat {
                display: flex;
                align-items: center;
                gap: 8px;
                font-weight: 500;
            }

            .search-stat i {
                color: var(--text-accent);
            }

            .search-stat strong {
                color: var(--text-accent);
                font-weight: 800;
            }

            .loading {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: var(--card-bg);
                padding: 40px;
                border-radius: var(--border-radius-xl);
                box-shadow: var(--shadow-xl);
                text-align: center;
                z-index: 1000;
                border: 1px solid var(--border-primary);
                backdrop-filter: blur(20px);
            }

            .spinner {
                width: 60px;
                height: 60px;
                border: 5px solid var(--border-primary);
                border-top: 5px solid transparent;
                border-radius: 50%;
                animation: spinGlow 1.2s linear infinite;
                margin: 0 auto 24px;
                position: relative;
            }

            .spinner::before {
                content: '';
                position: absolute;
                inset: -5px;
                border-radius: 50%;
                background: conic-gradient(from 0deg, var(--primary-gradient), var(--accent-gradient), var(--primary-gradient));
                z-index: -1;
                animation: rotate 2s linear infinite;
            }

            @keyframes spinGlow {
                0% {
                    transform: rotate(0deg);
                    filter: drop-shadow(0 0 5px rgba(102, 126, 234, 0.5));
                }
                50% {
                    filter: drop-shadow(0 0 15px rgba(102, 126, 234, 0.8));
                }
                100% {
                    transform: rotate(360deg);
                    filter: drop-shadow(0 0 5px rgba(102, 126, 234, 0.5));
                }
            }

            @keyframes rotate {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }

            .loading p {
                font-size: 1.1rem;
                font-weight: 600;
                color: var(--text-secondary);
            }

            /* Animaciones de nodos específicas */
            .tree-node.highlight {
                animation: nodeHighlight 1s ease-in-out;
            }

            @keyframes nodeHighlight {
                0%, 100% {
                    box-shadow: var(--shadow-md);
                    transform: scale(1);
                }
                50% {
                    box-shadow: 0 0 25px rgba(79, 172, 254, 0.6);
                    transform: scale(1.05);
                    border-color: var(--highlight-color);
                }
            }

            /* Mejoras adicionales para el árbol */
            .tree-legend {
                display: flex;
                justify-content: center;
                gap: 24px;
                margin-bottom: 20px;
                padding: 16px;
                background: var(--bg-tertiary);
                border-radius: var(--border-radius-md);
                border: 1px solid var(--border-primary);
                flex-wrap: wrap;
            }

            .legend-item {
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 0.9rem;
                color: var(--text-secondary);
                font-weight: 500;
            }

            .legend-color {
                width: 16px;
                height: 16px;
                border-radius: 4px;
                border: 1px solid var(--border-primary);
            }

            .legend-node { background: var(--node-bg); }
            .legend-insert { background: var(--insertion-color); }
            .legend-split { background: var(--split-color); }
            .legend-highlight { background: var(--highlight-color); }
        `;

        // Agregar los estilos adicionales al head
        const styleElement = document.createElement('style');
        styleElement.textContent = additionalStyles;
        document.head.appendChild(styleElement);

        // Demostración automática del árbol
        function demoArbol() {
            const demoData = [
                {id: 500, nombre: "Demo User 1"},
                {id: 750, nombre: "Demo User 2"},
                {id: 250, nombre: "Demo User 3"},
                {id: 900, nombre: "Demo User 4"},
                {id: 100, nombre: "Demo User 5"}
            ];

            let index = 0;
            const insertDemo = () => {
                if (index < demoData.length) {
                    const data = demoData[index];
                    const proveedor = {
                        id: data.id,
                        nombre: data.nombre,
                        servicio: "demo",
                        calificacion: 4.0 + Math.random(),
                        ubicacion: "Demo Zone"
                    };

                    arbolVisualizacion.insertar(data.id, proveedor);
                    showMessage(`Insertando ${data.nombre} (ID: ${data.id})`, 'success');

                    setTimeout(() => {
                        actualizarVisualizacion();
                        index++;
                        if (index < demoData.length) {
                            setTimeout(insertDemo, 2000);
                        }
                    }, 500);
                }
            };

            insertDemo();
        }

        // Agregar función para limpiar árbol
        window.limpiarArbol = function() {
            if (confirm('¿Estás seguro de que quieres limpiar todo el árbol?')) {
                arbolVisualizacion.limpiar();
                actualizarVisualizacion();
                showMessage('Árbol limpiado', 'success');
            }
        };

        // Agregar función demo
        window.iniciarDemo = function() {
            limpiarArbol();
            setTimeout(() => {
                demoArbol();
            }, 1000);
        };

        // Manejo de errores
        window.addEventListener('error', function(e) {
            console.error('Error global:', e.error);
            hideLoading();
            showMessage('Ha ocurrido un error inesperado', 'error');
        });
    </script>

    <!-- Agregar leyenda para el árbol -->
    <style>
        .tree-legend {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-bottom: 20px;
            padding: 16px;
            background: var(--bg-tertiary);
            border-radius: var(--border-radius-md);
            border: 1px solid var(--border-primary);
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            border: 1px solid var(--border-primary);
        }

        .legend-node { background: var(--node-bg); }
        .legend-insert { background: var(--insertion-color); }
        .legend-split { background: var(--split-color); }
        .legend-highlight { background: var(--highlight-color); }

        /* Botones de demo */
        .demo-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .btn-demo {
            background: var(--warning-gradient);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-normal);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-demo:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
    </style>

    <script>
        // Agregar leyenda y controles demo al contenedor del árbol
        document.addEventListener('DOMContentLoaded', function() {
            const treeSection = document.querySelector('.tree-section');
            const treeContainer = treeSection.querySelector('.tree-container');

            // Agregar controles de demo
            const demoControls = document.createElement('div');
            demoControls.className = 'demo-controls';
            demoControls.innerHTML = `
                <button class="btn-demo" onclick="iniciarDemo()">
                    <i class="fas fa-play"></i>
                    Demo Automático
                </button>
                <button class="btn-demo" onclick="demoInsercionCompleja()">
                    <i class="fas fa-magic"></i>
                    Demo Divisiones
                </button>
            `;
            treeContainer.parentNode.insertBefore(demoControls, treeContainer);

            // Agregar leyenda
            const legend = document.createElement('div');
            legend.className = 'tree-legend';
            legend.innerHTML = `
                <div class="legend-item">
                    <div class="legend-color legend-node"></div>
                    <span>Nodo Normal</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-insert"></div>
                    <span>Insertando</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-split"></div>
                    <span>División</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-highlight"></div>
                    <span>Resaltado</span>
                </div>
                <div class="legend-item">
                    <i class="fas fa-leaf" style="color: var(--success-color);"></i>
                    <span>Nodo Hoja</span>
                </div>
            `;
            treeContainer.parentNode.insertBefore(legend, treeContainer);
        });

        // Demo de inserción compleja para mostrar divisiones
        function demoInsercionCompleja() {
            arbolVisualizacion.limpiar();
            actualizarVisualizacion();

            const secuencia = [10, 20, 5, 6, 12, 30, 7, 17, 25, 35, 40, 50, 60, 70, 80];
            let index = 0;

            const insertarSecuencial = () => {
                if (index < secuencia.length) {
                    const id = secuencia[index];
                    const proveedor = {
                        id: id,
                        nombre: `Demo ${id}`,
                        servicio: "demo",
                        calificacion: 4.0 + Math.random(),
                        ubicacion: "Demo"
                    };

                    // Destacar que se va a insertar
                    showMessage(`Insertando ID: ${id}`, 'success');

                    // Insertar con retraso para ver la animación
                    setTimeout(() => {
                        arbolVisualizacion.insertar(id, proveedor);
                        actualizarVisualizacion();

                        // Resaltar el nodo insertado
                        setTimeout(() => {
                            const nodos = document.querySelectorAll('.tree-node');
                            nodos.forEach(nodo => {
                                const claves = nodo.querySelectorAll('.node-key');
                                claves.forEach(clave => {
                                    if (parseInt(clave.textContent) === id) {
                                        nodo.classList.add('highlight');
                                        setTimeout(() => {
                                            nodo.classList.remove('highlight');
                                        }, 1500);
                                    }
                                });
                            });
                        }, 300);

                        index++;
                        if (index < secuencia.length) {
                            setTimeout(insertarSecuencial, 2500);
                        } else {
                            showMessage('Demo completado - ¡Observa las divisiones!', 'success');
                        }
                    }, 500);
                }
            };

            insertarSecuencial();
        }

        // Mejorar la función de dibujo del árbol
        function dibujarArbol(nodo, container, nivel, posicion) {
            if (!nodo || nodo.claves.length === 0) return;

            let nivelDiv = container.querySelector(`[data-nivel="${nivel}"]`);
            if (!nivelDiv) {
                nivelDiv = document.createElement('div');
                nivelDiv.className = 'node-level';
                nivelDiv.setAttribute('data-nivel', nivel);
                nivelDiv.style.marginTop = nivel > 0 ? '40px' : '20px';
                container.appendChild(nivelDiv);
            }

            const nodoDiv = document.createElement('div');
            nodoDiv.className = 'tree-node';
            nodoDiv.setAttribute('data-posicion', posicion);

            // Agregar claves con tooltips informativos
            nodo.claves.forEach((clave, index) => {
                const claveSpan = document.createElement('span');
                claveSpan.className = 'node-key';
                claveSpan.textContent = clave;

                if (nodo.datos[index]) {
                    const datos = nodo.datos[index];
                    claveSpan.title = `${datos.nombre} - ${datos.servicio} (${datos.calificacion}★)`;
                }

                nodoDiv.appendChild(claveSpan);
            });

            // Indicador de hoja
            if (nodo.es_hoja) {
                const hojaIcon = document.createElement('i');
                hojaIcon.className = 'fas fa-leaf';
                hojaIcon.style.color = 'var(--success-color)';
                hojaIcon.style.marginLeft = '8px';
                hojaIcon.style.fontSize = '0.8rem';
                hojaIcon.title = 'Nodo Hoja';
                nodoDiv.appendChild(hojaIcon);
            }

            // Agregar información del grado
            const infoSpan = document.createElement('div');
            infoSpan.style.fontSize = '0.7rem';
            infoSpan.style.color = 'var(--text-muted)';
            infoSpan.style.marginTop = '4px';
            infoSpan.textContent = `${nodo.claves.length}/${2 * arbolVisualizacion.grado - 1}`;
            infoSpan.title = 'Claves actuales / Máximo permitido';
            nodoDiv.appendChild(infoSpan);

            nivelDiv.appendChild(nodoDiv);

            // Animación de entrada
            nodoDiv.style.opacity = '0';
            nodoDiv.style.transform = 'scale(0.8) translateY(-20px)';
            setTimeout(() => {
                nodoDiv.style.transition = 'all 0.5s ease-out';
                nodoDiv.style.opacity = '1';
                nodoDiv.style.transform = 'scale(1) translateY(0)';
            }, nivel * 100);

            // Dibujar hijos
            if (!nodo.es_hoja && nodo.hijos) {
                nodo.hijos.forEach((hijo, index) => {
                    if (hijo && hijo.claves.length > 0) {
                        dibujarArbol(hijo, container, nivel + 1, posicion * 10 + index);
                    }
                });
            }
        }
    </script>
</body>
</html>